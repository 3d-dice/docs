---
sidebar_position: 3
---

# Advanced Roller
The Advanced Roller module is a part of the [@3d-dice/dice-ui](https://github.com/3d-dice/dice-ui) package. This UI module provides a simple text input field and a clear button. The field is connect to [Dice Parser Interface](/docs/addons/parser). On submit, the field will send the roll notation to FDP to be parsed and will return the result to the callback `onSubmit`. The clear button will clear out any values stored in the parser and invokes the `onClear` callback, which is usually a good place to clear your dice-box as well.

![Advanced Roller Screenshot](/img/advRoller.jpg)
<!-- ![Advanced Roller Screenshot](/img/advRoller.jpg#gh-light-mode-only)![Advanced Roller Screenshot](/img/advRoller-dark.jpg#gh-dark-mode-only) -->

## Install
Add the dice-ui module using
```
npm install @3d-dice/dice-ui
```

## Setup
Then create a new instance of the roller
```javascript
import { AdvancedRoller } from '@3d-dice/dice-ui'

const Roller = new AdvancedRoller()
```

### Config Options
The `AdvancedRoller` only has one argument which is a config object

| Option | type | default | Description |
|-|-|-|-|
| target | `string` :dom node selector | `document.body` | The target DOM node to inject the roller into |
| [onSubmit](#onsubmit) | `function` | noop | callback triggered on form submit, after notation has been parsed |
| [onClear](#onclear) | `function` | noop | callback triggered when form reset event is triggered |
| [onReroll](#onreroll) | `function` | noop | callback triggered when FDP returns reroll results |
| [onResults](#onresults) | `function` | noop | callback triggered when there are no reRoll results and the final result object has been parsed by FDP |

## Methods

| Method | Arguments | Description |
|-|-|-|
| submitForm | `event` :event - form submit | Take the submit event and passes the input notation to FDP. Calls `onSubmit` callback with results. |
| clear | none | Clears any values stored in FDP. Calls the `onClear` callback |
| handleResults | `results` :object | Passes roll results object to FDP to check for rerolls. Gets the final parsed results from FDP. Calls `onResults` callback |

## Custom Events
### resultsAvailable
When the final results are available, a custom event called `resultsAvailable` is also dispatched. The final results object can be found on the `event.details` property.

Example
```javascript
document.addEventListener('resultsAvailable', (e) => console.log('roll results: ', e.detail))
```

## Callbacks
The advanced roller lets you decide what to do with the results the parser returns. 

### onSubmit
After the value of the notation input has been processed by FDP, this callback is triggered, passing back the notation object generated by FDP. This can then be passed onto Dice-Box for rolling.

Example
```javascript
const Roller = new AdvancedRoller({
  target: '#roller',
  // highlight-start
  onSubmit: (notation) => {
    diceBox.roll(notation)
  }
  // highlight-end
})
```

### onClear
After clearing out out any values remaining in FDP, this callback is trigger to allow for follow-up actions in the scene

Example
```javascript
const Roller = new AdvancedRoller({
  target: '#roller',
  onSubmit: (notation) => {
    diceBox.roll(notation)
  },
  // highlight-start
  onClear: () => {
    diceBox.clear()
    Display.clear()  // Display refers to Display Results module available in @3d-dice/dice-ui
  }
  // highlight-end
})
```

### onReroll
When the `handleResults` method is called FDP will parse rollResults looking for anything that would trigger a reroll. If the right conditions are met then DRP will return an array of dice objects that need a reroll. The array is then passed on to this callback to be handled as you see fit.

Example
```javascript
const Roller = new AdvancedRoller({
  target: '#rollers',
  onSubmit: (notation) => {
    diceBox.roll(notation)
  },
  onClear: () => {
    diceBox.clear()
    Display.clear()
  },
  // highlight-start
  onReroll: (rolls) => {
    rolls.forEach(roll => diceBox.add(roll))
  }
  // highlight-end
})
```

### onResults
This callback is triggered when the `handleResults` method has determined that there are no reroll results and the [final result object](/docs/usage/objects#roll-result-array-object) has been parsed by FDP. The final result object is passed on to this callback to be handled as you see fit.

Example
```javascript
const Roller = new AdvancedRoller({
  target: '#rollers',
  onSubmit: (notation) => {
    diceBox.roll(notation)
  },
  onClear: () => {
    diceBox.clear()
    Display.clear()
  },
  onReroll: (rolls) => {
    rolls.forEach(roll => diceBox.add(roll))
  },
  // highlight-start
  onResults: (results) => {
    Display.showResults(results)  // Display refers to Display Results module available in @3d-dice/dice-ui
  }
  // highlight-end
})
```